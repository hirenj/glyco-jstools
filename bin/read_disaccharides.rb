#!/usr/bin/env ruby

# This script checks the pathway coverage of structures

require File.join(File.dirname(__FILE__), 'script_common')

require 'postgres'

structures_sql = 'select distinct parent from structural_features.disaccharide inner join biological_context.structure_has_taxon on disaccharide.structure_id = structure_has_taxon.structure_id where structure_has_taxon.taxon_id = 9606'

conn = PGconn.connect("zsweb3",5432,'','','glycome','postgres','postgres')
result = conn.exec(structures_sql)

class GlycoCTMono < NamespacedMonosaccharide
  def self.Default_Namespace
    NamespacedMonosaccharide::NAMESPACES[:stephan]
  end
end

text = <<__BLAH__
lman-hex|6:d(2)methyl(3)methyl#dglc-hex(3)methyl(6)methyl
lgro-dman-hep(6)phospho-ethanolamine#lgro-dman-hep(3)phospho-ethanolamine
dgal-hex|1:aldi(2)n-acetyl#dglc-hex(2)n-acetyl(6)sulfate
dgal-hex|1:aldi#dglc-hex(2)n-acetyl(6)sulfate
dgal-hex|1:aldi#lgal-hex|6:d
dglc-hex|6:a#dglc-hex(2)n-sulfate
dglc-hex|6:a#lara-pen
dgal-hex(2)n-acetyl#dara-hex|3:d|6:d
dman-hex#dman-hex|6:d
dman-hex#drib-hex|3:d|6:d
lgal-hex|6:d(2)acetyl#dglc-hex|6:a
dgal-hex(2)n-acetyl#lthr-hex|4,5:enx|6:a
dglc-hex|6:d#dara-hex|2:d|6:d(3)n-acetyl
dglc-hex|6:d#dglc-hex
dglc-hex(6)phosphate#dgal-hex
dglc-hex(6)pyruvate#dgal-hex(6)pyruvate
dglc-hex#dgal-hex(6)phosphate
lman-hex|6:d#dman-hex(2)n-acetyl
dgal-hex|6:d(2)n-acetyl(4)amino#lalt-hex|6:a(2)n-acetyl
dman-oct|1:a|2:keto|3:d#dglc-hex
dgal-hex|6:d(2)n-acetyl#dman-hex|6:a(2)n-acetyl(3)n-acetyl
dgal-hex(6)sulfate#dgal-hex
dgal-hex(6)sulfate#dgal-hex(6)sulfate
dgal-hex(6)sulfate#dglc-hex|6:a
dglc-hex#dgro-dgal-non|1:a|2:keto|3:d(5)n-acetyl
lgul-hex|6:a#dman-hex|6:a
dman-oct|1:a|2:keto|3:d#hep
dglc-hex#xman-hex|6:d
lgal-hex|6:d#dglc-hex
dglc-hex|1:a#dglc-hex
dglc-hex|1:aldi(2)n-acetyl#dgal-hex
dman-oct|1:a|2:keto|3:d#lgro-dman-hep(6)phosphate
dglc-hex|1:aldi(2)n-acetyl#dgal-hex|6:d
dglc-hex|1:aldi#lgal-hex|6:d
dglc-hex(2)acetyl(3)acetyl(6)acetyl#dglc-hex(2)acetyl(3)acetyl(6)acetyl
drib-hex|2:d|6:d#drib-hex|2:d|6:d
dglc-hex(2)amino#dgal-hex
dman-hex|1:aldi(5)anhydro#lido-hex|6:a
dglc-hex(2)n-acetyl(6)sulfate#lgal-hex|6:d
dglc-hex(2)n-acetyl#dgal-hex(3)phosphate
dglc-hex(2)n-acetyl#dgal-hex(6)amino
dxyl-pen|1:aldi#dgal-hex
dglc-hex(2)n-acetyl#dgal-hex(6)sulfate
dglc-hex(2)n-acetyl#dglc-hex(2)n-dimethyl
dman-hex(3)methyl#dman-hex
dxyl-pen#dglc-hex|6:a(4)methyl(6)methyl
dglc-hex(2)n-acetyl#lglc-hex|6:d(2)n-acetyl
dman-hex|6:a#lgul-hex|6:a
xman-hex|6:d#xman-hex|6:d
dglc-hex(2)n-acetyl#xgal-hex
dglc-hex(2)n-sulfate(2)amino(3)sulfate(6)sulfate#dglc-hex|6:a
dglc-hex(2)n-sulfate(2)amino(6)sulfate#lthr-hex|4,5:enx|6:a
dglc-hex(2)n-sulfate(3)sulfate#dglc-hex|6:a
hep#hep
dman-hex(6)phosphate#dgal-hex
xman-hex|6:d#dgal-hex(2)n-acetyl
dman-hex#dara-pen
dgro-tri|1:aldi#dgal-hex
dman-hex|6:a#dman-hex|6:a
dglc-hex(2)n-acetyl#lido-hex|6:a
dglc-hex(2)n-acetyl#lgal-hex|6:d(2)n-acetyl
dgal-hex#dgal-hex(2)amino
lgro-dman-hep(6)phospho-ethanolamine#lgro-dman-hep
dgal-hex|6:a#lman-hex|6:d
lido-hex|6:a#dglc-hex(2)n-sulfate
lman-hex|6:d#dglc-hex|6:a
dglc-hex#dman-hex|6:d
dgal-hex|6:a#dgal-hex|6:a
dglc-hex#dgro-dman-hep
dglc-hex(2)n-sulfate(6)sulfate#dglc-hex|6:a
lgro-dman-hep#lgro-dman-hep(3)phosphate
lgro-dman-hep#dglc-hex(6)phosphate
dgal-hex|6:d#lman-hex|6:d
lgro-dman-hep(3)phosphate#dglc-hex(2)n-acetyl
dgal-hex#dalt-hep|2:keto
lman-hex|6:d#dgal-hex|6:a
dglc-hex(2)n-acetyl#dgal-hex(2)methyl
lgal-hex|6:d#dgal-hex(2)n-acetyl
dglc-hex(2)n-sulfate(2)amino(6)sulfate#dglc-hex|6:a
dgal-hex#lthr-hex|4,5:enx|6:a
lgro-dman-hep(6)phosphate#dglc-hex
lido-hex|6:a(2)sulfate#dglc-hex(2)amino(3)sulfate
dglc-hex|6:a#lgal-hex|6:d
lgro-dman-hep#dglc-hex|6:a
dman-hex|6:d(4)n-acetyl#dman-hex|6:d(4)n-acetyl
dgal-hex|6:a#dglc-hex(2)n-acetyl
lman-hex|6:d#dgal-hex(2)n-acetyl
dglc-hex(2)amino#lthr-hex|4,5:enx|6:a
dara-pen#dgal-hex
lido-hex|6:a#dglc-hex(2)n-sulfate(6)sulfate
dglc-hex|1:aldi(2)n-acetyl(6)sulfate#dgal-hex
lman-hex|6:d#dman-hex|6:d
dglc-hex#lgro-dman-hep
dgal-hex|6:d#dglc-hex
dman-hex#dgal-hex(2)n-acetyl
dglc-hex#dgal-hex(2)n-acetyl
dman-hex|1:aldi#dgal-hex
dglc-hex(2)amino#dglc-hex|6:a
dgal-hex(2)n-acetyl#dgal-hex(3)methyl
dglc-hex(6)anhydro#dglc-hex
dglc-hex(2)amino#dglc-hex
lara-pen#lara-pen
dgal-hex#lara-pen
dglc-hex#dara-hex|2:keto
dgal-hex#dara-pen
dglc-hex#dalt-hep|2:keto
dgal-hex(6)phosphate#dgal-hex
dglc-hex|1:aldi(2)n-acetyl(6)sulfate#dgal-hex(6)sulfate
dara-pen#dara-pen
lara-pen#dxyl-pen
lara-pen#dglc-hex
lgal-hex|6:d#dglc-hex|6:a
dglc-hex|6:d#dglc-hex|6:d
dglc-hex(2)n-acetyl#dman-hex(6)phospho-ethanolamine
dgro-dgal-non|1:a|2:keto|3:d(5)n-acetyl#dgal-hex
dglc-hex(2)n-acetyl#dglc-hex(2)amino
dglc-hex(2)n-sulfate#lido-hex|6:a(2)sulfate
dglc-hex|6:a#dglc-hex(2)n-sulfate(2)amino(6)sulfate
dgal-hex(2)n-acetyl#lgal-hex|6:d
lgal-hex|6:d#dgal-hex
lgal-hex(6)anhydro#dgal-hex
dglc-hex(2)n-acetyl#dgal-hex(3)sulfate
dglc-hex(2)n-acetyl(6)sulfate#lthr-hex|4,5:enx|6:a
dglc-hex|6:a#dman-hex
dman-hex#dman-hex(3)methyl
dgal-hex|6:a#dglc-hex(2)amino
dgal-hex(2)n-acetyl(6)sulfate#dglc-hex|6:a
dglc-hex(2)n-sulfate(2)amino(6)sulfate#lthr-hex|4,5:enx|6:a(2)sulfate
dglc-hex#dgal-hex|6:a
dgal-hex#lgal-hex(6)anhydro
dglc-hex(1)amino(2)n-acetyl#dglc-hex(2)n-acetyl
dgro-dman-hep#dgal-hex
dglc-hex(2)amino(3)sulfate#dglc-hex|6:a
dman-hex|1:aldi(1)sulfate(5)anhydro#lido-hex|6:a(2)sulfate
dgal-hex(2)n-acetyl(4)sulfate#lthr-hex|4,5:enx|6:a
dgal-hex(2)n-acetyl(4)sulfate#dglc-hex|6:a
dglc-hex|6:a#dglc-hex(2)n-sulfate(6)sulfate
dman-hex(3)methyl#dman-hex(3)methyl
lgro-dman-hep(4)phosphate#dglc-hex
dgal-hex|1:aldi#dgal-hex
lgro-dman-hep(4)phosphate#lgro-dman-hep(4)phosphate
dgal-hex|1:aldi(2)n-acetyl#dgro-dgal-non|1:a|2:keto|3:d
dglc-hex#dglc-hex(6)pyruvate
dgal-hex(6)sulfate#dglc-hex(2)n-acetyl(6)sulfate
lgro-dman-hep#dgro-dman-hep
dglc-hex(2)amino(4)phosphate#dman-oct|1:a|2:keto|3:d(4)phosphate
dgal-hex|1:aldi#dglc-hex(2)n-acetyl
dglc-hex(2)amino#lido-hex|6:a
dglc-hex|6:a#dglc-hex(2)amino
dglc-hex|6:a#dgal-hex(2)n-acetyl(4)sulfate
lman-hex|6:d#dgal-hex(2)n-acetyl(6)phosphate
dman-hex(6)phospho-ethanolamine#dman-hex
dman-hex#dgal-hex(6)phosphate
dman-hex|6:d#dman-hex|6:d
dglc-hex(2)n-acetyl(6)sulfate#dgal-hex(6)sulfate
dgal-hex#dgro-dgal-non|1:a|2:keto|3:d(5)n-acetyl(9)acetyl
lgal-hex|6:d#lgal-hex|6:d
lgro-dman-hep#lgro-dman-hep(6)phospho-ethanolamine
dman-hex|1:aldi#dglc-hex(2)n-acetyl
lgro-dman-hep#dgal-hex|6:a
dgal-hex#dgro-dgal-non|1:a|2:keto|3:d(5)amino
lara-pen#lman-hex|6:d
dglc-hex(2)n-acetyl#dgal-hex(2)n-acetyl(4)sulfate
dglc-hex(2)n-acetyl#dgal-hex(3|4)sulfate(2)n-acetyl
dglc-hex#dglc-hex(2)amino
dglc-hex#lara-pen
dman-hex(6)phosphate#dman-hex
lido-hex|6:a#dglc-hex(2)amino
dxyl-pen|1:aldi#dgal-hex(6)sulfate
dman-hex#dman-hex(6)phospho-ethanolamine
dgro-dgal-non|1:a|2:keto|3:d#lgal-hex|6:d
dglc-hex(2)n-sulfate(6)sulfate#lthr-hex|4,5:enx|6:a(2)sulfate
dman-oct|1:a|2:keto|3:d(4)phosphate#lgro-dman-hep
dxyl-pen#lara-pen
dglc-hex(2)n-acetyl#lthr-hex|4,5:enx|6:a
lido-hex|6:a(2)sulfate#dglc-hex(2)n-sulfate(2)amino(6)sulfate
dgal-hex(2)n-acetyl(6)sulfate#lthr-hex|4,5:enx|6:a
lido-hex|6:a(2)sulfate#dglc-hex(2)n-sulfate(6)sulfate
dgal-hex#dgro-dgal-non|1:a|2:keto|3:d
dglc-hex(2)n-acetyl#dgal-hex|6:d
dman-hex|1:aldi#dman-hex
dglc-hex(2)n-sulfate(2)amino(6)sulfate#lido-hex|6:a(2)sulfate
lgro-dman-hep#dglc-hex(2)amino
lgro-dman-hep#dglc-hex(2)n-acetyl
dgro-dgal-non|1:a|2:keto|3:d(5)n-glycolyl#dgro-dgal-non|1:a|2:keto|3:d(5)n-acetyl
dglc-hex(2)n-sulfate(6)sulfate#lido-hex|6:a(2)sulfate
lgro-dman-hep(4)phosphate#lgro-dman-hep
lgro-dman-hep#dgal-hex
dara-hex|2:keto#dara-hex|2:keto
dglc-hex|6:a#dglc-hex(2)n-acetyl(6)sulfate
dglc-hex(2)n-acetyl#lman-hex|6:d
dgal-hex|1:aldi(2)n-acetyl#dgro-dgal-non|1:a|2:keto|3:d(5)n-glycolyl
dman-hex#dxyl-hex|3:d|6:d
dgal-hex(2)n-acetyl#dglc-hex|6:a
dglc-hex|6:a#dgal-hex
dglc-hex|6:a#dgal-hex(2)n-acetyl
dara-hex|2:keto#dglc-hex
dglc-hex|6:a#dgal-hex(2)n-acetyl(6)sulfate
dglc-hex|6:a#dglc-hex|6:a
dgal-hex(2)n-acetyl#dglc-hex
dgal-hex(2)n-acetyl#dgro-dgal-non|1:a|2:keto|3:d(5)n-glycolyl
dxyl-pen#dglc-hex|6:a(4)methyl
dgal-hex|1:aldi(2)n-acetyl#dgro-dgal-non|1:a|2:keto|3:d(5)n-acetyl
dman-hex#lman-hex|6:d
lman-hex|6:d#dgal-hex
dglc-hex(2)amino(4)phosphate#dman-oct|1:a|2:keto|3:d
lman-hex|6:d#dman-hex
dman-oct|1:a|2:keto|3:d#lgro-dman-hep(4)phosphate
dglc-hex(2)n-acetyl#dman-oct|1:a|2:keto|3:d
dglc-hex#dglc-hex|6:a
dglc-hex(2)amino#dman-oct|1:a|2:keto|3:d
dglc-hex(2)amino#dglc-hex(2)amino
dgal-hex(2)n-acetyl#dgal-hex(2)n-acetyl
dgal-hex#dman-hex
dglc-hex|1:aldi(2)n-acetyl#dman-hex
dglc-hex|1:aldi#dgal-hex
dglc-hex|1:aldi#dglc-hex
lman-hex|6:d#dglc-hex(2)n-acetyl
dglc-hex(2)n-acetyl#dglc-hex
dgal-hex#dglc-hex(2)n-acetyl(6)sulfate
dman-hex#dglc-hex|6:a
dglc-hex(2)amino#dman-hex
dglc-hex#dglc-hex(2)n-acetyl
dman-hex#dman-hex(6)phosphate
dglc-hex(2)amino#dglc-hex(2)amino(4)phosphate
dxyl-pen#dgal-hex
dgal-hex#dglc-hex|6:a
dglc-hex(2)n-acetyl(6)sulfate#dgal-hex
dglc-hex#lgal-hex|6:d
lman-hex|6:d#dglc-hex
dgro-dgal-non|1:a|2:keto|3:d(5)n-glycolyl#dgro-dgal-non|1:a|2:keto|3:d(5)n-glycolyl
dman-hex#dxyl-pen
dglc-hex|6:a#dglc-hex(2)n-acetyl
dglc-hex(2)n-acetyl#dglc-hex|6:a
dgal-hex#lman-hex|6:d
dglc-hex#dxyl-pen
dglc-hex(2)n-acetyl#dgro-dgal-non|1:a|2:keto|3:d(5)n-acetyl
dglc-hex|6:a#dglc-hex
dgal-hex(2)n-acetyl#dgro-dgal-non|1:a|2:keto|3:d(5)n-acetyl
dxyl-pen#dxyl-pen
dglc-hex#dman-hex
dglc-hex#lman-hex|6:d
dman-oct|1:a|2:keto|3:d#lgro-dman-hep
dman-oct|1:a|2:keto|3:d#dman-oct|1:a|2:keto|3:d
dgro-dgal-non|1:a|2:keto|3:d(5)n-acetyl#dgro-dgal-non|1:a|2:keto|3:d(5)n-acetyl
lgro-dman-hep#lgro-dman-hep
dman-hex#dgal-hex
dman-hex#dglc-hex
lman-hex|6:d#lman-hex|6:d
lgro-dman-hep#dglc-hex
dgal-hex#dglc-hex
dgal-hex(2)n-acetyl#dglc-hex(2)n-acetyl
dgal-hex#dgro-dgal-non|1:a|2:keto|3:d(5)n-glycolyl
dgal-hex|1:aldi(2)n-acetyl#dglc-hex(2)n-acetyl
dglc-hex|1:aldi(2)n-acetyl#lgal-hex|6:d
dglc-hex(2)n-acetyl#dgal-hex(2)n-acetyl
dgal-hex|1:aldi(2)n-acetyl#dgal-hex
dgal-hex#dgal-hex(2)n-acetyl
dgal-hex(2)n-acetyl#dgal-hex
dglc-hex|1:aldi(2)n-acetyl#dglc-hex(2)n-acetyl
dglc-hex#dglc-hex
dgal-hex#lgal-hex|6:d
dgal-hex#dgal-hex
dglc-hex#dgal-hex
dglc-hex(2)n-acetyl#lgal-hex|6:d
dgal-hex#dglc-hex(2)n-acetyl
dgal-hex#dgro-dgal-non|1:a|2:keto|3:d(5)n-acetyl
dglc-hex(2)n-acetyl#dglc-hex(2)n-acetyl
dman-hex#dglc-hex(2)n-acetyl
dglc-hex(2)n-acetyl#dman-hex
dman-hex#dman-hex
dglc-hex(2)n-acetyl#dgal-hex
__BLAH__


#select disac, count(distinct structure_id) from (select parent || '#' || child as disac, disaccharide.structure_id from structural_features.disaccharide inner join biological_context.structure_has_taxon on disaccharide.structure_id = structure_has_taxon.structure_id where structure_has_taxon.taxon_id = 9606) as disacs group by disac order by count

result = text.split("\n").collect { |line| line.split("#")}.flatten.collect { |seq|
  seq.gsub!(/\(\-?\d\)sulfate/,'')
  seq.gsub!(/\(\-?\d\)n-sulfate/,'')
  seq.gsub!(/\(\-?\d\)phosphate/,'')
  seq.gsub!(/\(\-?\d\)phospho-ethanolamine/,'')
  seq.gsub!(/\(\-?\d\)ethanolamine/,'')
  seq.gsub!(/\(\d\)methyl/,'')
  seq  
}.uniq.sort

result.each { |struct|
  seq = "-#{struct}"
  begin
    Monosaccharide.Factory(GlycoCTMono, seq)
  rescue Exception => e
    p seq
  end  
}